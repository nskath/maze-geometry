<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Maze Designer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script>
        const initMaze = () => {
            const cells = document.querySelectorAll('.cell');
            cells.forEach((cell, index) => {
                const row = Math.floor(index / 7);
                const col = index % 7;

                const isTop = row === 0;
                const isBottom = row === 6;
                const isLeft = col === 0;
                const isRight = col === 6;

                const middleCol = 3;
                const middleRow = 3;

                if (isTop && col !== middleCol) cell.querySelector('.N').classList.add('active');
                if (isBottom && col !== middleCol) cell.querySelector('.S').classList.add('active');
                if (isLeft && row !== middleRow) cell.querySelector('.W').classList.add('active');
                if (isRight && row !== middleRow) cell.querySelector('.E').classList.add('active');
            });
        };

        document.addEventListener('DOMContentLoaded', function () {
            initMaze();

            document.querySelectorAll('.wall').forEach(wall => {
                wall.onclick = function () {
                    this.classList.toggle('active');
                    const cell = this.parentNode;
                    const cellIndex = Array.from(cell.parentNode.children).indexOf(cell);
                    const rowIndex = Math.floor(cellIndex / 7);
                    const colIndex = cellIndex % 7;

                    if (this.classList.contains('N') && rowIndex > 0) {
                        const above = cell.parentNode.children[cellIndex - 7].querySelector('.S');
                        above.classList.toggle('active', this.classList.contains('active'));
                    } else if (this.classList.contains('S') && rowIndex < 6) {
                        const below = cell.parentNode.children[cellIndex + 7].querySelector('.N');
                        below.classList.toggle('active', this.classList.contains('active'));
                    } else if (this.classList.contains('W') && colIndex > 0) {
                        const left = cell.parentNode.children[cellIndex - 1].querySelector('.E');
                        left.classList.toggle('active', this.classList.contains('active'));
                    } else if (this.classList.contains('E') && colIndex < 6) {
                        const right = cell.parentNode.children[cellIndex + 1].querySelector('.W');
                        right.classList.toggle('active', this.classList.contains('active'));
                    }
                };
            });
        });

        function submitGeometry() {
            const output = [];
            const cells = document.querySelectorAll('.cell');
            cells.forEach((cell, index) => {
                let walls = '';
                walls += cell.querySelector('.N').classList.contains('active') ? '1' : '0';
                walls += cell.querySelector('.E').classList.contains('active') ? '1' : '0';
                walls += cell.querySelector('.S').classList.contains('active') ? '1' : '0';
                walls += cell.querySelector('.W').classList.contains('active') ? '1' : '0';
                const hexValue = parseInt(walls, 2).toString(16);
                output.push(hexValue);
                if ((index + 1) % 7 === 0 && index !== cells.length - 1) {
                    output.push("', '");
                }
            });
            document.getElementById('output').innerText = "Resulting Geometry: ['" + output.join('') + "']";
        }
        
    </script>
</head>
<body>
    <h1>Maze Designer</h1>
    <div class="grid">
        {% for i in range(7) %}
            {% for j in range(7) %}
                <div class="cell">
                    <div class="wall N"></div>
                    <div class="wall E"></div>
                    <div class="wall S"></div>
                    <div class="wall W"></div>
                </div>
            {% endfor %}
        {% endfor %}
    </div>
    <button onclick="submitGeometry()">Submit Design</button>
    <pre id="output"></pre>
</body>
</html>
